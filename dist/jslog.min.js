/*! jslog 2014-11-25 */

!function(a,b){b([],a)}(function(){var a,b,c="jslog.me",d="/log",e="//"+c+d,f=1e4,g=1e4,h=4194304,i=5240,j=1048576,k="JSLOG_ME_POSTPONED_ITEMS",l="http:",m=!1;return function(n){function o(){this.enabled=!0,this.logUncaughtExceptions=!0,this.hookConsole=!0,this.trackHost=!0,this.collectSystemInfo=!0,this.trackLaunches=!0,this.key="",this.version="",this.sessionId=this.guid()}function p(){if(this.inOperation=!1,this.xmlHttpRequest=C(),this.http=null,!this.xmlHttpRequest)try{this.http=require("http")}catch(a){this.http=null}}function q(){this.timePrefix=B()+"",this.counter=0,this.postponed={},this.postponedLength=0,this.postponedSize=0,this.lastItem=n,this.loadPostponedData()}function r(a,b){if("object"==typeof window&&window&&window.localStorage)try{window.localStorage[k+a]=b}catch(c){}}function s(a,b){var c=a.match(F),d=b.match(F);return c&&d&&c.length>1&&d.length>1?"["+c[1]+", "+d[1]+"]":c?a:d?b:"[]"}function t(a,b,c,d){this.protocol=a,this.sender=b,this.queue=c,this.logger=d,this.start()}function u(a){this.options=new o,a!==n&&(this.options=this.parseOptions(a));var b;"undefined"!=typeof window?(b=window.location.protocol,"http:"!==b.toLowerCase()&&"https:"!==b.toLowerCase()&&(b=l)):b=l,this.protocol=b,this.systemInfoSent=!1,this._batchQueue=[],this._packetSize=0,this.senderService=new p,this.pendingSenderService=new t(b,this.senderService,K,this),this.init()}function v(a){if(a._batchQueue.length){var b=y(a);a.postpone(b)}}function w(a,b,c,d){if(d=!!d,z(b)>h){var e=y(b);b.postpone(e)}if(c&&x(b,c),(!b.senderService.inOperation||d)&&b._batchQueue.length){var f=y(b);b.senderService.sendPacket(a,f,d,function(){w(a,b,n,!1)},function(){b.postpone(f),w(a,b,n,!1)})}}function x(a,b){a._batchQueue.push(b)}function y(a){var b="["+a._batchQueue.join(", ")+"]";return a._batchQueue=[],b}function z(a){for(var b=0,c=0;c<a._batchQueue.length;c++)b+=a._batchQueue[c].length;return b}function A(a,b){return function(){return b.apply(a,arguments)}}function B(){return Date.now?Date.now():(new Date).getTime()}function C(){try{return"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}throw new Error("XMLHttpRequest not supported")}),new XMLHttpRequest}catch(a){return n}}function D(a){a.systemInfoSent||a.systemInfo(a.options.collectSystemInfo)}function E(a){var b={};return a?("undefined"!=typeof a.name&&(b.name=a.name),"undefined"!=typeof a.message&&(b.message=a.message),"undefined"!=typeof a.stack&&(b.stack=a.stack),"undefined"!=typeof a.fileName&&(b.fileName=a.fileName),"undefined"!=typeof a.lineNumber&&(b.lineNumber=a.lineNumber),"undefined"!=typeof a.columnNumber&&(b.columnNumber=a.columnNumber),"undefined"!=typeof a.description&&(b.description=a.description),b):b}o.prototype.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),p.prototype.sendXmlHttpRequest=function(a,b,c,d,f){var h=this,i=this.xmlHttpRequest;this.inOperation=!0,i.open("POST",a+e,!0),i.timeout=g,i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.onreadystatechange=function(){4===i.readyState&&(h.inOperation=!1,200===i.status||400===i.status?d(b):f(b))};try{i.send(b)}catch(j){f(b)}},p.prototype.sendNodeJsHttpRequest=function(a,b){var e={host:c,port:"80",path:d,method:"POST",headers:{"Content-Type":"application/json"}},f=this.http.request(e,function(){});f.write(b),f.end()},p.prototype.sendPacket=function(a,b,c,d,e){return this.inOperation&&!c?void e(b):void(this.xmlHttpRequest?this.sendXmlHttpRequest(a,b,c,d,e):this.http&&this.sendNodeJsHttpRequest(a,b,c,d,e))},q.prototype.loadPostponedData=function(){if("object"!=typeof window||!window||!window.localStorage)return n;try{this.postponed={},this.lastItem=n,this.postponedSize=0;var a=k.length,b=0;for(var c in window.localStorage)if(window.localStorage.hasOwnProperty(c)&&0===c.indexOf(k)){var d=c.substr(a);this.lastItem=d,this.postponed[d]=window.localStorage[c],this.postponedSize=this.postponedSize+this.postponed[d].length,b++}return this.postponedLength=b,b?this.postponed:n}catch(e){return n}},q.prototype.add=function(a){function b(){c.counter++,c.lastItem=c.timePrefix+c.counter,c.postponed[c.lastItem]=a,c.postponedSize=c.postponedSize+a.length,r(c.lastItem,a)}var c=this;if(!(c.postponedSize>j))if(this.lastItem){var d=this.postponed[c.lastItem];if(d.length>i)b();else{var e=s(d,a);c.postponed[c.lastItem]=e,r(c.lastItem,e),c.postponedSize=c.postponedSize+e.length-d.length}}else b()};var F=/^\s*\[\s*(.+)\s*\]\s*$/;q.prototype.haveItems=function(){return this.postponedLength},q.prototype.fetchItem=function(){if(!this.postponedLength)return n;for(var a in this.postponed)if(this.postponed.hasOwnProperty(a))return{key:a,value:this.postponed[a]};return n},q.prototype.deleteItem=function(a){if(this.postponedLength--,this.postponedSize=this.postponedSize-this.postponed[a].length,delete this.postponed[a],"object"==typeof window&&window&&window.localStorage)try{delete window.localStorage[k+a]}catch(b){}this.lastItem===a&&(this.lastItem=n)},t.prototype.sendPendingItem=function(){if(!this.sender.inOperation&&this.queue.haveItems()){var a=this.queue.fetchItem(),b=this;if(a){var c=a.key,d=a.value;this.sender.sendPacket(this.protocol,d,!1,function(){b.queue.deleteItem(c),b.sendPendingItem()},function(){v(b.logger)})}}},t.prototype.start=function(){if(!this.handle){var a=this;this.handle=setInterval(function(){a.sendPendingItem()},f)}},t.prototype.stop=function(){this.handle&&(clearInterval(this.handle),this.handle=n)},u.prototype.renewSession=function(){this.options.sessionId=this.options.guid(),this.systemInfoSent=!1},u.prototype.parseOptions=function(a){var b=new o;for(var c in a)a.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(b[c]=a[c]);return b},u.prototype.sendToServer=function(a,c,d){if(this.options.enabled){var e={key:a,sessionId:this.options.sessionId,hostId:b,time:B(),type:c,data:d},f=JSON.stringify(e);w(this.protocol,this,f)}},u.prototype.postpone=function(a){K.add(a)},u.prototype.log=function(){try{D(this);var a=arguments.length>1?arguments:arguments[0];this.sendToServer(this.options.key,"log",a),"function"==typeof G&&G.apply(console,arguments)}catch(b){}},u.prototype.info=function(){try{D(this);var a=arguments.length>1?arguments:arguments[0];this.sendToServer(this.options.key,"info",a),"function"==typeof J&&J.apply(console,arguments)}catch(b){}},u.prototype.warn=function(){try{D(this);var a=arguments.length>1?arguments:arguments[0];this.sendToServer(this.options.key,"warn",a),"function"==typeof H&&H.apply(console,arguments)}catch(b){}},u.prototype.error=function(){try{D(this);var a=arguments.length>1?arguments:arguments[0];this.sendToServer(this.options.key,"error",a),"function"==typeof I&&I.apply(console,arguments)}catch(b){}},u.prototype.exception=function(a){try{D(this),this.sendToServer(this.options.key,"exception",E(a)),"function"==typeof H&&H.apply(console,arguments)}catch(b){}},u.prototype.systemInfo=function(a){try{var b={};a&&"object"==typeof navigator?(b.userAgent=navigator.userAgent,b.platform=navigator.platform,b.version=this.options.version):(b.userAgent="",b.platform="",b.version=this.options.version),this.systemInfoSent=!0,this.sendToServer(this.options.key,"systemInfo",b)}catch(c){}},u.prototype.init=function(){this.options.enabled&&(this.pendingSenderService.sendPendingItem(),this.options.trackHost&&this.trackHost(),this.options.hookConsole&&this.hookConsole(),this.options.logUncaughtExceptions&&this.hookUncaughtExceptions(),this.options.trackLaunches&&this.systemInfo(this.options.collectSystemInfo))};var G,H,I,J;u.prototype.trackHost=function(){if(!b)if("object"==typeof window&&"localStorage"in window&&null!==window.localStorage){try{b=window.localStorage.getItem("JsLogToken")}catch(a){b=null}b||(b=o.prototype.guid(),window.localStorage.setItem("JsLogToken",b))}else b=o.prototype.guid()},u.prototype.hookConsole=function(){m||("undefined"!=typeof console?(G=console.log,H=console.warn,I=console.error,J=console.info,console.log=A(this,this.log),console.warn=A(this,this.warn),console.error=A(this,this.error),console.info=A(this,this.info)):console={log:A(this,this.log),warn:A(this,this.warn),error:A(this,this.error),info:A(this,this.info)},m=!0)},u.prototype.hookUncaughtExceptions=function(){"undefined"!=typeof window&&(window.onerror=A(this,this.windowErrorHandler)),"undefined"!=typeof process&&process.on("uncaughtException",A(this,this.windowErrorHandler))},u.prototype.windowErrorHandler=function(a,b,c,d,e){if(this.options.enabled)try{e?this.sendToServer(this.options.key,"uncaughtException",{msg:a,url:b,line:c,column:d,errorObj:E(e)}):this.sendToServer(this.options.key,"uncaughtException",E(a))}catch(f){}},u.prototype.waitUntilCompletion=function(){};var K=new q;"undefined"!=typeof window&&(window.JsLog=window.JsLog||u),a=u}(),a},"function"==typeof define&&define.amd?define:function(a,b){"undefined"!=typeof module?module.exports=b():b()});
//# sourceMappingURL=jslog.min.js.map