/*! jslog 2015-08-14 */

!function(a,b){"use strict";b([],a)}(function(){"use strict";var a,b=null,c="jslog.me",d="/log",e="//"+c+d,f=1e4,g=1e4,h=1048576,i=5240,j=1048576,k="JSLOG_ME_POSTPONED_ITEMS",l="http:",m=["log","warn","info","error"];return function(){function c(a,b){return function(){return b.apply(a,arguments)}}function d(){return Date.now?Date.now():(new Date).getTime()}var n=function(){function a(){this.enabled=!0,this.key="",this.version="",this.sessionId=this.guid(),this.hookConsole=!0,this.collectSystemInfo=!0,this.trackLaunches=!0,this.logUncaughtExceptions=!0,this.console={enabled:!0,display:!0,watch:["log","info","warn","error"]},this.network={enabled:!0,codes:[],codesExclude:[200,304,404],logRequest:!0,logResponse:!0},this.userInteraction={enabled:!1,events:["click","dblclick","change","tap","drag","drop"],navigation:!0}}return a.prototype.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),a.prototype.assign=function(a){function b(a,c){if(c)for(var d in c)c.hasOwnProperty(d)&&a.hasOwnProperty(d)&&(a[d]instanceof Array?a[d]=Array.prototype.slice.call(c[d]):"object"==typeof a[d]?b(a[d],c[d]):a[d]=c[d])}b(this,a),a&&a.console&&"undefined"!=typeof a.console.enabled&&(this.hookConsole=a.console.enabled)},a}(),o=function(){function a(){this.inOperation=!1,this.xmlHttpRequest=b()}function b(){function a(a){try{return new ActiveXObject(a)}catch(b){}}var b=window.XMLHttpRequest;return"undefined"==typeof b?a("Msxml2.XMLHTTP.6.0")||a("Msxml2.XMLHTTP.3.0")||a("Msxml2.XMLHTTP")||a("Microsoft.XMLHTTP"):new b}return a.prototype.sendXmlHttpRequest=function(a,b,c,d){var f=this,h=this.xmlHttpRequest;this.inOperation=!0,h.open("POST",a+e,!0),h.timeout=g,h.setRequestHeader("Content-Type","application/json; charset=UTF-8"),h.onreadystatechange=function(){4===h.readyState&&(f.inOperation=!1,200===h.status||400===h.status?c(b):d(b))};try{h.send(b)}catch(i){d(b)}},a.prototype.sendPacket=function(a,b,c,d,e){return this.inOperation&&!c?void e(b):void(this.xmlHttpRequest&&this.sendXmlHttpRequest(a,b,d,e))},a}(),p=function(){function a(){this.clear(),this.loadPostponedData()}function b(a,b){if("object"==typeof window&&window&&window.localStorage)try{window.localStorage[k+a]=b}catch(c){}}function c(a,b){var c=a.match(e),d=b.match(e);return c&&d&&c.length>1&&d.length>1?"["+c[1]+", "+d[1]+"]":c?a:d?b:"[]"}a.prototype.clear=function(){this.timePrefix=d()+"",this.counter=0,this.postponed={},this.postponedLength=0,this.postponedSize=0,this.lastItem=void 0},a.prototype.clearWithPostponedData=function(){try{if("object"==typeof window&&window&&window.localStorage)for(var a in window.localStorage)window.localStorage.hasOwnProperty(a)&&0===a.indexOf(k)&&delete window.localStorage[a];this.clear()}catch(b){}},a.prototype.loadPostponedData=function(){if("object"==typeof window&&window&&window.localStorage)try{this.postponed={},this.lastItem=void 0,this.postponedSize=0;var a=k.length,b=0;for(var c in window.localStorage)if(window.localStorage.hasOwnProperty(c)&&0===c.indexOf(k)){var d=c.substr(a);this.lastItem=d,this.postponed[d]=window.localStorage[c],this.postponedSize=this.postponedSize+this.postponed[d].length,b++}if(this.postponedLength=b,b)return this.postponed}catch(e){}},a.prototype.add=function(a){function d(){e.counter++,e.lastItem=e.timePrefix+e.counter,e.postponed[e.lastItem]=a,e.postponedSize=e.postponedSize+a.length,b(e.lastItem,a)}var e=this;if(!a||"string"!=typeof a||"["!==a.charAt(0))throw new Error("Invalid log message - not an array");if(!(e.postponedSize>j))if(this.lastItem){var f=this.postponed[e.lastItem];if(f.length>i)d(),this.postponedLength++;else{var g=c(f,a);e.postponed[e.lastItem]=g,b(e.lastItem,g),e.postponedSize=e.postponedSize+g.length-f.length}}else d(),this.postponedLength++};var e=/^\s*\[\s*(.+)\s*]\s*$/;return a.prototype.haveItems=function(){return this.postponedLength},a.prototype.fetchItem=function(){if(!this.postponedLength)return void 0;for(var a in this.postponed)if(this.postponed.hasOwnProperty(a))return{key:a,value:this.postponed[a]};return void 0},a.prototype.deleteItem=function(a){if("undefined"!=typeof this.postponed[a]){if(this.postponedLength--,this.postponedSize=this.postponedSize-this.postponed[a].length,delete this.postponed[a],"object"==typeof window&&window&&window.localStorage)try{delete window.localStorage[k+a]}catch(b){}this.lastItem===a&&(this.lastItem=void 0)}},a}(),q=function(){function a(a,b,c){this.protocol=a,this.sender=b,this.queue=c}return a.SEND_POSTPONE_INTERVAL=f,a.prototype.sendPendingItem=function(){if(!this.sender.inOperation&&this.queue.haveItems()){var a=this.queue.fetchItem(),b=this;if(a){var c=a.key,d=a.value;this.sender.sendPacket(this.protocol,d,!1,function(){b.queue.deleteItem(c),b.sendPendingItem()},function(){})}}},a.prototype.start=function(){if(!this.handle){var a=this;this.handle=setInterval(function(){a.sendPendingItem()},f)}},a.prototype.stop=function(){this.handle&&(clearInterval(this.handle),this.handle=void 0)},a}(),r=function(){function b(a){this.options=new n,this.options.assign(a);var b;"undefined"!=typeof window?(b=window.location.protocol,"http:"!==b.toLowerCase()&&"https:"!==b.toLowerCase()&&(b=l)):b=l,this.protocol=b,this.systemInfoSent=!1,this._batchQueue=[],this.senderService=new o,this.pendingSenderService=new q(b,this.senderService,s),this.init(),this.pendingSenderService.start()}function f(a,b,c,d){if(d=!!d,j(b)>h){var e=i(b);b.postpone(e)}if(c&&g(b,c),(!b.senderService.inOperation||d)&&b._batchQueue.length){var k=i(b);b.senderService.sendPacket(a,k,d,function(){f(a,b,void 0,!1)},function(){b.postpone(k)})}}function g(a,b){a._batchQueue.push(b)}function i(a){var b="["+a._batchQueue.join(", ")+"]";return a._batchQueue=[],b}function j(a){for(var b=0,c=0;c<a._batchQueue.length;c++)b+=a._batchQueue[c].length;return b}function k(a){a.systemInfoSent||a.systemInfo()}function p(a){var b=[];return function c(a){"object"==typeof a&&a&&(b=b.concat(Object.getOwnPropertyNames(a)),c(Object.getPrototypeOf(a)))}(a),b}function r(a,b,c){try{k(a);var d=c.length>1?c:c[0],e=t(d);a.sendToServer(a.options.key,b,e),a.options.console.display&&("function"==typeof x[b]?x[b].apply(window.console,c):window&&window.console&&"function"==typeof window.console[b]&&window.console[b].apply(window.console,c))}catch(f){}}function t(a){if(a.length){var c=[];for(var d in a)a.hasOwnProperty(d)&&c.push(b.prototype.expand(a[d]));return c}return b.prototype.expand(a)}function u(a){var b={};return a?("undefined"!=typeof a.name&&(b.name=a.name),"undefined"!=typeof a.message&&(b.message=a.message),"undefined"!=typeof a.stack&&(b.stack=a.stack),"undefined"!=typeof a.fileName&&(b.fileName=a.fileName),"undefined"!=typeof a.lineNumber&&(b.lineNumber=a.lineNumber),"undefined"!=typeof a.columnNumber&&(b.columnNumber=a.columnNumber),"undefined"!=typeof a.description&&(b.description=a.description),b):b}function v(){if(!a)if("object"==typeof window&&"localStorage"in window&&null!==window.localStorage){try{a=window.localStorage.getItem("JsLogToken")}catch(b){a=null}if(!a){a=n.prototype.guid();try{window.localStorage.setItem("JsLogToken",a)}catch(b){}}}else a=n.prototype.guid()}function w(a,b){function c(){a.onerror=e,a.ontimeout=f,a.onload=g}function d(){try{var c=a._additionalInfo||{},d=b.options.network;if(c.status=a.status||0,c.statusText=a.statusText||"",b.options.network.logResponse){c.response=a.responseText;try{c.responseHeaders=a.getAllResponseHeaders()}catch(e){c.responseHeaders={}}}var f=d.codes.indexOf(a.status)>=0||!d.codes.length&&d.codesExclude.indexOf(a.status)<0;d.enabled&&f&&b.network(c)}catch(e){}}var e=a.onerror,f=a.ontimeout,g=a.onload;a.onerror=function(){d(),c(),"function"==typeof e&&e.apply(this,arguments)},a.ontimeout=function(){d(),c(),"function"==typeof f&&f.apply(this,arguments)},a.onload=function(){d(),c(),"function"==typeof g&&g.apply(this,arguments)}}b.prototype.renewSession=function(){this.options.sessionId=this.options.guid(),this.systemInfoSent=!1},b.prototype.sendToServer=function(b,c,e){if(this.options.enabled){e instanceof Error&&(e=u(e));var g={key:b,sessionId:this.options.sessionId,hostId:a,time:d(),type:c,data:e},h=JSON.stringify(g);f(this.protocol,this,h)}},b.prototype.postpone=function(a){s.add(a)},b.prototype.expand=function(a){function b(a){if("object"!=typeof a||null===a)return a;var d=a instanceof Array?[]:{};c.push(a);var e=p(a);e.sort();for(var f in e)if(e.hasOwnProperty(f)){var g=e[f],h=a[g];if("undefined"==typeof h||"function"==typeof h)continue;c.indexOf(h)>=0&&(h="<circular ref>"),d[g]=b(h)}return c.pop(),d}var c=[];return b(a)},b.prototype.log=function(){return r(this,"log",Array.prototype.slice.call(arguments))},b.prototype.info=function(){return r(this,"info",Array.prototype.slice.call(arguments))},b.prototype.warn=function(){return r(this,"warn",Array.prototype.slice.call(arguments))},b.prototype.error=function(){return r(this,"error",Array.prototype.slice.call(arguments))},b.prototype.exception=function(){return r(this,"exception",Array.prototype.slice.call(arguments))},b.prototype.network=function(){return r(this,"network",Array.prototype.slice.call(arguments))},b.prototype.systemInfo=function(){try{var a={};"object"==typeof navigator?(a.userAgent=navigator.userAgent,a.platform=navigator.platform,a.version=this.options.version):(a.userAgent="",a.platform="",a.version=this.options.version),this.systemInfoSent=!0,this.sendToServer(this.options.key,"systemInfo",a)}catch(b){}},b.prototype.exceptionToObject=u,b.prototype.init=function(){this.options.enabled&&(this.pendingSenderService.sendPendingItem(),v(),this.options.hookConsole&&this.hookConsole(),this.options.network.enabled&&this.hookNetwork(),this.options.logUncaughtExceptions&&this.hookUncaughtExceptions(),this.options.trackLaunches&&this.systemInfo())},b.prototype.finalize=function(){this.unhookNetwork(),this.unhookConsole()};var x={};b.prototype.hookConsole=function(){if("undefined"!=typeof window.console)for(var a in this.options.console.watch)if(this.options.console.watch.hasOwnProperty(a)){var b=this.options.console.watch[a];m.indexOf(b)>=0&&(x[b]=window.console[b],window.console[b]=c(this,this[b]))}},b.prototype.unhookConsole=function(){if("undefined"!=typeof window.console)for(var a in x)x.hasOwnProperty(a)&&(window.console[a]=x[a])};var y=null,z=null;return b.prototype.hookNetwork=function(){var a=this;if(!y&&window.XMLHttpRequest){var b=window.XMLHttpRequest.prototype;y=b.send,z=b.open,b.open=function(a,b){return b.indexOf(e)<0&&(this._additionalInfo={method:a,url:b}),z.apply(this,arguments)},b.send=function(b){return this._additionalInfo?(a.options.network.logRequest&&(this._additionalInfo.requestData=b),w(this,a),y.apply(this,arguments)):y.apply(this,arguments)}}},b.prototype.unhookNetwork=function(){var a=window.XMLHttpRequest.prototype;y&&(a.send=y,a.open=z,y=null,z=null)},b.prototype.hookUncaughtExceptions=function(){"undefined"!=typeof window&&(window.onerror=c(this,this.windowErrorHandler))},b.prototype.windowErrorHandler=function(a,b,c,d,e){if(this.options.enabled)try{e?this.sendToServer(this.options.key,"uncaughtException",{msg:a,url:b,line:c,column:d,errorObj:u(e)}):this.sendToServer(this.options.key,"uncaughtException",u(a))}catch(f){}},b}(),s=new p;r.JsLogOptions=n,r.PendingQueue=p,r.SenderService=o,r.PendingSenderService=q,"undefined"!=typeof window&&(window.JsLog=window.JsLog||r),b=r}(),b},"function"==typeof define&&define.amd?define:function(a,b){b()});
//# sourceMappingURL=jslog.min.js.map