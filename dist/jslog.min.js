/*! jslog 2015-10-26 */

!function(a,b){"use strict";b([],a)}(function(){"use strict";function a(a,b){return function(){return b.apply(a,arguments)}}function b(){return Date.now?Date.now():(new Date).getTime()}var c,d=null,e="jslog.me",f="/log",g="//"+e+f,h=1e4,i=1e4,j=1048576,k=5240,l=1048576,m="JSLOG_ME_POSTPONED_ITEMS",n="http:",o=["log","warn","info","error"],p=function(){function a(){this.enabled=!0,this.key="",this.version="",this.sessionId=this.guid(),this.hookConsole=!0,this.collectSystemInfo=!0,this.trackLaunches=!0,this.logUncaughtExceptions=!0,this.console={enabled:!0,display:!0,watch:["log","info","warn","error"]},this.network={enabled:!0,codes:[],codesExclude:[200,304,404],logRequest:!0,logResponse:!0},this.userInteraction={enabled:!1,events:["click","dblclick","change","tap","drag","drop"],navigation:!0}}return a.prototype.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),a.prototype.assign=function(a){function b(a,c){if(c)for(var d in c)c.hasOwnProperty(d)&&a.hasOwnProperty(d)&&(a[d]instanceof Array?a[d]=Array.prototype.slice.call(c[d]):"object"==typeof a[d]?b(a[d],c[d]):a[d]=c[d])}b(this,a),a&&a.console&&"undefined"!=typeof a.console.enabled&&(this.hookConsole=a.console.enabled)},a}(),q=function(){function a(){this.inOperation=!1,this.xmlHttpRequest=b()}function b(){function a(a){try{return new ActiveXObject(a)}catch(b){}}var b=window.XMLHttpRequest;return"undefined"==typeof b?a("Msxml2.XMLHTTP.6.0")||a("Msxml2.XMLHTTP.3.0")||a("Msxml2.XMLHTTP")||a("Microsoft.XMLHTTP"):new b}return a.prototype.sendXmlHttpRequest=function(a,b,c,d){var e=this,f=this.xmlHttpRequest;this.inOperation=!0,f.open("POST",a+g,!0),f.timeout=i,f.setRequestHeader("Content-Type","application/json; charset=UTF-8"),f.onreadystatechange=function(){4===f.readyState&&(e.inOperation=!1,200===f.status||400===f.status?c(b):d(b))};try{f.send(b)}catch(h){d(b)}},a.prototype.sendPacket=function(a,b,c,d,e){return this.inOperation&&!c?void e(b):void(this.xmlHttpRequest&&this.sendXmlHttpRequest(a,b,d,e))},a}(),r=function(){function a(){this.clear(),this.loadPostponedData()}function c(a,b){if("object"==typeof window&&window&&window.localStorage)try{window.localStorage[m+a]=b}catch(c){}}function d(a,b){var c=a.match(e),d=b.match(e);return c&&d&&c.length>1&&d.length>1?"["+c[1]+", "+d[1]+"]":c?a:d?b:"[]"}a.prototype.clear=function(){this.timePrefix=b()+"",this.counter=0,this.postponed={},this.postponedLength=0,this.postponedSize=0,this.lastItem=void 0},a.prototype.clearWithPostponedData=function(){try{if("object"==typeof window&&window&&window.localStorage)for(var a in window.localStorage)window.localStorage.hasOwnProperty(a)&&0===a.indexOf(m)&&delete window.localStorage[a];this.clear()}catch(b){}},a.prototype.loadPostponedData=function(){if("object"==typeof window&&window&&window.localStorage)try{this.postponed={},this.lastItem=void 0,this.postponedSize=0;var a=m.length,b=0;for(var c in window.localStorage)if(window.localStorage.hasOwnProperty(c)&&0===c.indexOf(m)){var d=c.substr(a);this.lastItem=d,this.postponed[d]=window.localStorage[c],this.postponedSize=this.postponedSize+this.postponed[d].length,b++}if(this.postponedLength=b,b)return this.postponed}catch(e){}},a.prototype.add=function(a){function b(){e.counter++,e.lastItem=e.timePrefix+e.counter,e.postponed[e.lastItem]=a,e.postponedSize=e.postponedSize+a.length,c(e.lastItem,a)}var e=this;if(!a||"string"!=typeof a||"["!==a.charAt(0))throw new Error("Invalid log message - not an array");if(!(e.postponedSize>l))if(this.lastItem){var f=this.postponed[e.lastItem];if(f.length>k)b(),this.postponedLength++;else{var g=d(f,a);e.postponed[e.lastItem]=g,c(e.lastItem,g),e.postponedSize=e.postponedSize+g.length-f.length}}else b(),this.postponedLength++};var e=/^\s*\[\s*(.+)\s*]\s*$/;return a.prototype.haveItems=function(){return this.postponedLength},a.prototype.fetchItem=function(){if(!this.postponedLength)return void 0;for(var a in this.postponed)if(this.postponed.hasOwnProperty(a))return{key:a,value:this.postponed[a]};return void 0},a.prototype.deleteItem=function(a){if("undefined"!=typeof this.postponed[a]){if(this.postponedLength--,this.postponedSize=this.postponedSize-this.postponed[a].length,delete this.postponed[a],"object"==typeof window&&window&&window.localStorage)try{delete window.localStorage[m+a]}catch(b){}this.lastItem===a&&(this.lastItem=void 0)}},a}(),s=function(){function a(a,b,c){this.protocol=a,this.sender=b,this.queue=c}return a.SEND_POSTPONE_INTERVAL=h,a.prototype.sendPendingItem=function(){if(!this.sender.inOperation&&this.queue.haveItems()){var a=this.queue.fetchItem(),b=this;if(a){var c=a.key,d=a.value;this.sender.sendPacket(this.protocol,d,!1,function(){b.queue.deleteItem(c),b.sendPendingItem()},function(){})}}},a.prototype.start=function(){if(!this.handle){var a=this;this.handle=setInterval(function(){a.sendPendingItem()},h)}},a.prototype.stop=function(){this.handle&&(clearInterval(this.handle),this.handle=void 0)},a}(),t=function(){function d(a){this.options=new p,this.options.assign(a);var b;"undefined"!=typeof window?(b=window.location.protocol,"http:"!==b.toLowerCase()&&"https:"!==b.toLowerCase()&&(b=n)):b=n,this.protocol=b,this.systemInfoSent=!1,this._batchQueue=[],this.senderService=new q,this.pendingSenderService=new s(b,this.senderService,u),this.init(),this.pendingSenderService.start()}function e(a,b,c,d){if(d=!!d,i(b)>j){var g=h(b);b.postpone(g)}if(c&&f(b,c),(!b.senderService.inOperation||d)&&b._batchQueue.length){var k=h(b);b.senderService.sendPacket(a,k,d,function(){e(a,b,void 0,!1)},function(){b.postpone(k)})}}function f(a,b){a._batchQueue.push(b)}function h(a){var b="["+a._batchQueue.join(", ")+"]";return a._batchQueue=[],b}function i(a){for(var b=0,c=0;c<a._batchQueue.length;c++)b+=a._batchQueue[c].length;return b}function k(a){a.systemInfoSent||a.systemInfo()}function l(a){var b=[];return function c(a){"object"==typeof a&&a&&(b=b.concat(Object.getOwnPropertyNames(a)),c(Object.getPrototypeOf(a)))}(a),b}function m(a,b,c){try{k(a);var d=c.length>1?c:c[0],e=r(d);a.sendToServer(a.options.key,b,e),a.options.console.display&&("function"==typeof x[b]?x[b].apply(window.console,c):window&&window.console&&"function"==typeof window.console[b]&&window.console[b].apply(window.console,c))}catch(f){}}function r(a){if("object"==typeof a&&a&&a.length){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(d.prototype.expand(a[c]));return b}return d.prototype.expand(a)}function t(a){var b={};return a?("undefined"!=typeof a.name&&(b.name=a.name),"undefined"!=typeof a.message&&(b.message=a.message),"undefined"!=typeof a.stack&&(b.stack=a.stack),"undefined"!=typeof a.fileName&&(b.fileName=a.fileName),"undefined"!=typeof a.lineNumber&&(b.lineNumber=a.lineNumber),"undefined"!=typeof a.columnNumber&&(b.columnNumber=a.columnNumber),"undefined"!=typeof a.description&&(b.description=a.description),b):b}function v(){if(!c)if("object"==typeof window&&"localStorage"in window&&null!==window.localStorage){try{c=window.localStorage.getItem("JsLogToken")}catch(a){c=null}if(!c){c=p.prototype.guid();try{window.localStorage.setItem("JsLogToken",c)}catch(a){}}}else c=p.prototype.guid()}function w(a,b){function c(){a.onerror=e,a.ontimeout=f,a.onload=g}function d(){try{var c=a._additionalInfo||{},d=b.options.network;if(c.status=a.status||0,c.statusText=a.statusText||"",b.options.network.logResponse){c.response=a.responseText;try{c.responseHeaders=a.getAllResponseHeaders()}catch(e){c.responseHeaders={}}}var f=d.codes.indexOf(a.status)>=0||!d.codes.length&&d.codesExclude.indexOf(a.status)<0;d.enabled&&f&&b.network(c)}catch(e){}}var e=a.onerror,f=a.ontimeout,g=a.onload;a.onerror=function(){d(),c(),"function"==typeof e&&e.apply(this,arguments)},a.ontimeout=function(){d(),c(),"function"==typeof f&&f.apply(this,arguments)},a.onload=function(){d(),c(),"function"==typeof g&&g.apply(this,arguments)}}d.prototype.renewSession=function(){this.options.sessionId=this.options.guid(),this.systemInfoSent=!1},d.prototype.sendToServer=function(a,d,f){if(this.options.enabled){f instanceof Error&&(f=t(f));var g={key:a,sessionId:this.options.sessionId,hostId:c,time:b(),type:d,data:f},h=JSON.stringify(g);e(this.protocol,this,h)}},d.prototype.postpone=function(a){u.add(a)},d.prototype.expand=function(a){function b(a){if("object"!=typeof a||null===a)return a;var d=a instanceof Array?[]:{};c.push(a);var e=l(a);e.sort();for(var f in e)if(e.hasOwnProperty(f)){var g=e[f],h=a[g];if("undefined"==typeof h||"function"==typeof h)continue;c.indexOf(h)>=0&&(h="<circular ref>"),d[g]=b(h)}return c.pop(),d}var c=[];return b(a)},d.prototype.log=function(){return m(this,"log",Array.prototype.slice.call(arguments))},d.prototype.info=function(){return m(this,"info",Array.prototype.slice.call(arguments))},d.prototype.warn=function(){return m(this,"warn",Array.prototype.slice.call(arguments))},d.prototype.error=function(){return m(this,"error",Array.prototype.slice.call(arguments))},d.prototype.exception=function(){return m(this,"exception",Array.prototype.slice.call(arguments))},d.prototype.network=function(){return m(this,"network",Array.prototype.slice.call(arguments))},d.prototype.systemInfo=function(){try{var a={};"object"==typeof navigator?(a.userAgent=navigator.userAgent,a.platform=navigator.platform,a.version=this.options.version):(a.userAgent="",a.platform="",a.version=this.options.version),this.systemInfoSent=!0,this.sendToServer(this.options.key,"systemInfo",a)}catch(b){}},d.prototype.exceptionToObject=t,d.prototype.init=function(){this.options.enabled&&(this.pendingSenderService.sendPendingItem(),v(),this.options.hookConsole&&this.hookConsole(),this.options.network.enabled&&this.hookNetwork(),this.options.logUncaughtExceptions&&this.hookUncaughtExceptions(),this.options.trackLaunches&&this.systemInfo())},d.prototype.finalize=function(){this.unhookNetwork(),this.unhookConsole()};var x={};d.prototype.hookConsole=function(){if("undefined"!=typeof window.console)for(var b in this.options.console.watch)if(this.options.console.watch.hasOwnProperty(b)){var c=this.options.console.watch[b];o.indexOf(c)>=0&&(x[c]=window.console[c],window.console[c]=a(this,this[c]))}},d.prototype.unhookConsole=function(){if("undefined"!=typeof window.console)for(var a in x)x.hasOwnProperty(a)&&(window.console[a]=x[a])};var y=null,z=null;return d.prototype.hookNetwork=function(){var a=this;if(!y&&window.XMLHttpRequest){var b=window.XMLHttpRequest.prototype;y=b.send,z=b.open,b.open=function(a,b){return b.indexOf(g)<0&&(this._additionalInfo={method:a,url:b}),z.apply(this,arguments)},b.send=function(b){return this._additionalInfo?(a.options.network.logRequest&&(this._additionalInfo.requestData=b),w(this,a),y.apply(this,arguments)):y.apply(this,arguments)}}},d.prototype.unhookNetwork=function(){var a=window.XMLHttpRequest.prototype;y&&(a.send=y,a.open=z,y=null,z=null)},d.prototype.hookUncaughtExceptions=function(){"undefined"!=typeof window&&(window.onerror=a(this,this.windowErrorHandler))},d.prototype.windowErrorHandler=function(a,b,c,d,e){if(this.options.enabled)try{e?this.sendToServer(this.options.key,"uncaughtException",{msg:a,url:b,line:c,column:d,errorObj:t(e)}):this.sendToServer(this.options.key,"uncaughtException",t(a))}catch(f){}},d}(),u=new r;return t.JsLogOptions=p,t.PendingQueue=r,t.SenderService=q,t.PendingSenderService=s,"undefined"!=typeof window&&(window.JsLog=window.JsLog||t),d=t},"function"==typeof define&&define.amd?define:function(a,b){b()});
//# sourceMappingURL=jslog.min.js.map